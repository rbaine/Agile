var MongoDB=require("mongodb").MongoClient,Express=require("express"),bodyParser=require("body-parser"),multer=require("multer"),User=require("./user"),Utils=require("./utils"),app=Express(),dbHost="mongodb://127.0.0.1",dbPort=27017,dbName="/agile",dbConn=null,_this=this;app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(multer()),app.get("/user/:id",function(e,t){User.get(_this.dbConn,e.params.id,function(e){t.send(e)})}),app.get("/userList",function(e,t){User.list(_this.dbConn,function(e){t.send(e)})}),app["delete"]("/user/:id",function(e,t){User["delete"](_this.dbConn,e.params.id,function(e){t.send(e)})}),app.post("/user",function(e,t){var n=e.body;User.post(_this.dbConn,n,function(e){t.send(e)})}),app.put("/user",function(e,t){var n=e.body;User.update(_this.dbConn,n,function(e){t.send(e)})});var server=app.listen(8080,function(){var e=server.address().address,t=server.address().port;MongoDB.connect(dbHost+":"+dbPort.toString()+dbName,function(e,t){if(e)throw e;_this.dbConn=t}),console.log("Agile_Node app listening at: %s:%s",e,t)}),User=function(){"use strict";var e="MM/dd/yyyy hh:mm:ss",t=1;return{get:function(t,n,s){var r=t.collection("users"),o={id:Number(n)},i=new Date;console.log("user.get "+i.format(e)),r.findOne(o,function(e,t){s(null!==t?JSON.stringify(t):'{error: "not found"}')})},post:function(t,n,s){var r=t.collection("users"),o=new Date;console.log("user.put "+o.format(e)),null!==n.ud?r.insert(n,function(e,t){s(t)}):s('{"err": "invalid input"}')},"delete":function(t,n,s){var r=t.collection("users"),o={id:Number(n)},i=new Date;console.log("user.delete "+i.format(e)),r.remove(o,function(e,t){s(t)})},update:function(t,n,s){var r=t.collection("users"),o={id:Number(n.id)},i={$set:n},u=new Date;console.log("user.update "+u.format(e)),r.update(o,i,function(e,t){s(t)})},list:function(n,s){var r=new Date;console.log("user.list "+r.format(e));var o=n.collection("users");o.find().sort({id:t}).toArray(function(e,t){s(t)})}}}();module.exports=User,module.exports=function(){Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e}}();